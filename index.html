<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão Financeira</title>
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
  <style>
    body {
      padding: 20px;
    }
  </style>
</head>

<body>
  <div class="ui container">
    <h2 class="ui dividing header">Receitas</h2>
    <table id="receitas-table" class="ui celled table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
    <button class="ui primary button" id="add-receita">Adicionar Receita</button>

    <h2 class="ui dividing header">Despesas</h2>
    <table id="despesas-table" class="ui celled table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
    <button class="ui primary button" id="add-despesa">Adicionar Despesa</button>

    <h2 class="ui dividing header">Balanço</h2>
    <div id="balanco" class="ui large header"></div>
  </div>

  <!-- Modal para adicionar Receita -->
  <div id="add-receita-modal" class="ui modal">
    <div class="header">Adicionar Receita</div>
    <div class="content">
      <div class="ui form">
        <div class="fields">
          <div class="eight wide field">
            <input type="text" id="modal-receita-descricao" placeholder="Descrição">
          </div>
          <div class="eight wide field">
            <input type="text" class="money" id="modal-receita-valor" placeholder="Valor">
          </div>
        </div>
      </div>
    </div>
    <div class="actions">
      <div class="ui primary button" id="modal-add-receita">Adicionar</div>
      <div class="ui button">Cancelar</div>
    </div>
  </div>

  <!-- Modal para adicionar Despesa -->
  <div id="add-despesa-modal" class="ui modal">
    <div class="header">Adicionar Despesa</div>
    <div class="content">
      <div class="ui form">
        <div class="fields">
          <div class="eight wide field">
            <input type="text" id="modal-despesa-descricao" placeholder="Descrição">
          </div>
          <div class="eight wide field">
            <input type="text" class="money" id="modal-despesa-valor" placeholder="Valor">
          </div>
        </div>
      </div>
    </div>
    <div class="actions">
      <div class="ui primary button" id="modal-add-despesa">Adicionar</div>
      <div class="ui button">Cancelar</div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>

  <script>
    $(document).ready(function () {
      $('.money').mask('000.000.000.000.000,00', { reverse: true });

      var receitas = [];
      var despesas = [];

      // Adicionar Receita
      $('#add-receita').on('click', function () {
        $('#add-receita-modal').modal('show');
      });

      // Adicionar Despesa
      $('#add-despesa').on('click', function () {
        $('#add-despesa-modal').modal('show');
      });

      // Adicionar Receita através do modal
      $('#modal-add-receita').on('click', function () {
        var descricao = $('#modal-receita-descricao').val();
        var valor = $('#modal-receita-valor').val();

        if (descricao && valor) {
          var receita = {
            descricao: descricao,
            valor: valor
          };

          receitas.push(receita);
          renderReceitas();
          calcularBalanco();
          $('#modal-receita-descricao').val('');
          $('#modal-receita-valor').val('');
          $('#add-receita-modal').modal('hide');
        } else {
          alert('Preencha todos os campos!');
        }
      });

      // Adicionar Despesa através do modal
      $('#modal-add-despesa').on('click', function () {
        var descricao = $('#modal-despesa-descricao').val();
        var valor = $('#modal-despesa-valor').val();

        if (descricao && valor) {
          var despesa = {
            descricao: descricao,
            valor: valor
          };

          despesas.push(despesa);
          renderDespesas();
          calcularBalanco();
          $('#modal-despesa-descricao').val('');
          $('#modal-despesa-valor').val('');
          $('#add-despesa-modal').modal('hide');
        } else {
          alert('Preencha todos os campos!');
        }
      });

      // Renderizar Receitas
      function renderReceitas() {
        var receitasTable = $('#receitas-table tbody');
        receitasTable.empty();

        for (var i = 0; i < receitas.length; i++) {
          var receita = receitas[i];

          var row = '<tr>' +
            '<td>' + receita.descricao + '</td>' +
            '<td>' + receita.valor + '</td>' +
            '<td><button class="ui negative button excluir-receita" data-index="' + i + '">Excluir</button></td>' +
            '</tr>';

          receitasTable.append(row);
        }

        // Adicionar evento de exclusão para os botões de excluir receita
        $('.excluir-receita').on('click', function () {
          var index = $(this).data('index');
          receitas.splice(index, 1);
          renderReceitas();
          calcularBalanco();
        });
      }

      // Renderizar Despesas
      function renderDespesas() {
        var despesasTable = $('#despesas-table tbody');
        despesasTable.empty();

        for (var i = 0; i < despesas.length; i++) {
          var despesa = despesas[i];

          var row = '<tr>' +
            '<td>' + despesa.descricao + '</td>' +
            '<td>' + despesa.valor + '</td>' +
            '<td><button class="ui negative button excluir-despesa" data-index="' + i + '">Excluir</button></td>' +
            '</tr>';

          despesasTable.append(row);
        }

        // Adicionar evento de exclusão para os botões de excluir despesa
        $('.excluir-despesa').on('click', function () {
          var index = $(this).data('index');
          despesas.splice(index, 1);
          renderDespesas();
          calcularBalanco();
        });
      }

      // Calcular Balanço
      function calcularBalanco() {
        var totalReceitas = 0;
        for (var i = 0; i < receitas.length; i++) {
          totalReceitas += parseFloat(receitas[i].valor.replace(/\./g, "").replace(",", "."));
        }

        var totalDespesas = 0;
        for (var i = 0; i < despesas.length; i++) {
          totalDespesas += parseFloat(despesas[i].valor.replace(/\./g, "").replace(",", "."));
        }

        var balanco = totalReceitas - totalDespesas;
        var balancoElement = $('#balanco');

        if (balanco >= 0) {
          balancoElement.removeClass('red');
          balancoElement.addClass('green');
        } else {
          balancoElement.removeClass('green');
          balancoElement.addClass('red');
        }

        balancoElement.text('Balanço: R$ ' + formatCurrency(balanco));
      }

      // Formatar valor monetário
      function formatCurrency(value) {
        var formattedValue = value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        return formattedValue;
      }

    });
  </script>
</body>

</html>
